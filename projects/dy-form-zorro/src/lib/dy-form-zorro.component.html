<!--通用错误提示-->
<ng-template #errorTpl let-control>
  <ng-container *ngIf="control.hasError(control.name)">
    {{control.getError(control.name)}}
  </ng-container>
</ng-template>


<ng-template #label let-model>
  <nz-form-label [nzRequired]="model.required"
                 jdDyFormLabelDef
                 [ngClass]="dyForm.labelClass(model)"
                 [ngStyle]="model.labelStyle"
                 [nzFor]="model.controlName">{{model.label}}
  </nz-form-label>
</ng-template>

<ng-template #inputControl let-model let-control=control>
  <input nz-input
         [id]="model.name"
         [placeholder]="model.placeHolder"
         [formControl]="control"
         [disabled]="model.disabled"
         [nzSize]="model.size"
         [type]="model.inputType"
         [readOnly]="model.readonly"/>
</ng-template>

<ng-template #inputNumberControl let-model let-control=control>
  <nz-input-number [formControl]="control"
                   class="dy-form-input-number"
                   [nzPlaceHolder]="model.placeHolder"
                   [nzMin]="model.min"
                   [nzStep]="model.step"
                   [nzPrecision]="model.precision"
                   [nzMax]="model.max"
                   [nzSize]="model.size"
                   [nzDisabled]="model.disabled">
  </nz-input-number>
</ng-template>

<ng-template #textAreaControl let-model let-control=control>
  <textarea nz-input
            [id]="model.controlName"
            [placeholder]="model.placeHolder"
            [formControl]="control"
            [disabled]="model.disabled"
            [nzSize]="model.size"
            [nzAutosize]="model.autosize"
            [readOnly]="model.readonly">
  </textarea>
</ng-template>

<ng-template #selectControl let-model let-control=control>
  <nz-select [formControl]="control"
             class="dy-form-select"
             style="width: 100%;"
             [nzAllowClear]="model.allowClear"
             [nzSize]="model.size"
             [disabled]="model.disabled"
             [nzClearIcon]="model.clearIcon"
             [nzDropdownClassName]="model.dropdownClassName"
             [nzMaxTagCount]="model.maxTagCount"
             [nzMaxTagPlaceholder]="model.maxTagPlaceholder"
             (ngModelChange)="model.ngModelChange($event)"
             (nzOpenChange)="model.openChange($event)"
             [nzLoading]="model.loading"
             [nzRemoveIcon]="model.removeIcon"
             [nzSuffixIcon]="model.suffixIconPv"
             [nzShowSearch]="model.showSearch"
             [nzShowArrow]="model.showArrow"
             [nzDropdownMatchSelectWidth]="model.dropdownMatchSelectWidth"
             [nzMode]="model.mode"
             [nzDropdownStyle]="model.dropdownStyle"
             [nzMaxMultipleCount]="model.maxMultipleCount"
             [nzNotFoundContent]="model.notFoundContent"
             [nzMenuItemSelectedIcon]="model.menuItemSelectedIcon"
             [nzDisabled]="model.disabled"
             [nzPlaceHolder]="model.placeHolder">
    <nz-option *ngFor="let item of model.optionContent"
               [nzValue]="item.value"
               [nzLabel]="item.label"
               [nzDisabled]="item.disabled">
    </nz-option>
  </nz-select>
</ng-template>

<ng-template #formGroupControl let-model let-type=type let-control=control>
  <nz-input-group [nzAddOnAfter]="model.addOnAfter"
                  [nzAddOnBefore]="model.addOnBefore"
                  [nzPrefix]="model.prefix"
                  [nzSuffix]="model.suffix">
    <ng-container *ngIf="type === 'INPUT'">
      <ng-template [ngTemplateOutlet]="inputControl"
                   [ngTemplateOutletContext]="{$implicit: model, control: control}">
      </ng-template>
    </ng-container>
    <ng-container *ngIf="type === 'INPUT_NUMBER'">
      <ng-template [ngTemplateOutlet]="inputNumberControl"
                   [ngTemplateOutletContext]="{$implicit: model, control: control}">
      </ng-template>
    </ng-container>
    <ng-container *ngIf="type === 'SELECT'">
      <ng-template [ngTemplateOutlet]="selectControl"
                   [ngTemplateOutletContext]="{$implicit: model, control: control}">
      </ng-template>
    </ng-container>
  </nz-input-group>
</ng-template>

<jd-dy-form [dyFormRef]="dyFormRef" #dyForm>
  <nz-form-item *jdDyFormColumnDef="let control; let model = model name 'INPUT'">
    <ng-template [ngTemplateOutlet]="label" [ngTemplateOutletContext]="{$implicit: model}"></ng-template>

    <nz-form-control [nzErrorTip]="errorTpl"
                     jdDyFormControlDef
                     [ngStyle]="model.controlStyle"
                     [nzValidateStatus]="control"
                     [ngClass]="dyForm.controlClass(model)">
     <!-- <input nz-input
             [id]="model.name"
             [placeholder]="model.placeHolder"
             [formControl]="control"
             [disabled]="model.disabled"
             [nzSize]="model.size"
             [readOnly]="model.readonly"/>-->
      <ng-template [ngTemplateOutlet]="inputControl"
                   [ngTemplateOutletContext]="{$implicit: model, control: control}">
      </ng-template>
    </nz-form-control>
  </nz-form-item>

  <nz-form-item *jdDyFormColumnDef="let control; let model = model name 'INPUT_GROUP'">
    <ng-template [ngTemplateOutlet]="label" [ngTemplateOutletContext]="{$implicit: model}"></ng-template>

    <nz-form-control [nzErrorTip]="errorTpl"
                     jdDyFormControlDef
                     [nzValidateStatus]="control"
                     [ngStyle]="model.controlStyle"
                     [ngClass]="dyForm.controlClass(model)">
      <ng-template [ngTemplateOutlet]="formGroupControl"
                   [ngTemplateOutletContext]="{$implicit: model, control: control, type: 'INPUT'}">
      </ng-template>
    </nz-form-control>
  </nz-form-item>

  <nz-form-item *jdDyFormColumnDef="let control; let model = model name 'INPUT_NUMBER'">
    <ng-template [ngTemplateOutlet]="label" [ngTemplateOutletContext]="{$implicit: model}"></ng-template>

    <nz-form-control [nzErrorTip]="errorTpl"
                     jdDyFormControlDef
                     [nzValidateStatus]="control"
                     [ngStyle]="model.controlStyle"
                     [ngClass]="dyForm.controlClass(model)">
      <ng-template [ngTemplateOutlet]="inputNumberControl"
                   [ngTemplateOutletContext]="{$implicit: model, control: control}">
      </ng-template>
    </nz-form-control>
  </nz-form-item>

  <nz-form-item *jdDyFormColumnDef="let control; let model = model name 'INPUT_NUMBER_GROUP'">
    <ng-template [ngTemplateOutlet]="label" [ngTemplateOutletContext]="{$implicit: model}"></ng-template>

    <nz-form-control [nzErrorTip]="errorTpl"
                     jdDyFormControlDef
                     [nzValidateStatus]="control"
                     [ngStyle]="model.controlStyle"
                     [ngClass]="dyForm.controlClass(model)">
      <ng-template [ngTemplateOutlet]="formGroupControl"
                   [ngTemplateOutletContext]="{$implicit: model, control: control, type: 'INPUT_NUMBER'}">
      </ng-template>
    </nz-form-control>
  </nz-form-item>

  <nz-form-item *jdDyFormColumnDef="let control; let model = model name 'TEXTAREA'">
    <ng-template [ngTemplateOutlet]="label" [ngTemplateOutletContext]="{$implicit: model}"></ng-template>

    <nz-form-control [nzErrorTip]="errorTpl"
                     jdDyFormControlDef
                     [nzValidateStatus]="control"
                     [ngStyle]="model.controlStyle"
                     [ngClass]="dyForm.controlClass(model)">
      <ng-template [ngTemplateOutlet]="textAreaControl"
                   [ngTemplateOutletContext]="{$implicit: model, control: control}">
      </ng-template>
    </nz-form-control>
  </nz-form-item>

  <nz-form-item *jdDyFormColumnDef="let control; let model = model name 'SELECT'">
    <ng-template [ngTemplateOutlet]="label" [ngTemplateOutletContext]="{$implicit: model}"></ng-template>

    <nz-form-control [nzErrorTip]="errorTpl"
                     jdDyFormControlDef
                     [nzValidateStatus]="control"
                     [ngStyle]="model.controlStyle"
                     [ngClass]="dyForm.controlClass(model)">
      <ng-template [ngTemplateOutlet]="selectControl"
                   [ngTemplateOutletContext]="{$implicit: model, control: control}">
      </ng-template>
    </nz-form-control>
  </nz-form-item>

  <nz-form-item *jdDyFormColumnDef="let control; let model = model name 'SELECT_GROUP'">
    <ng-template [ngTemplateOutlet]="label" [ngTemplateOutletContext]="{$implicit: model}"></ng-template>

    <nz-form-control [nzErrorTip]="errorTpl"
                     jdDyFormControlDef
                     [nzValidateStatus]="control"
                     [ngStyle]="model.controlStyle"
                     [ngClass]="dyForm.controlClass(model)">
      <ng-template [ngTemplateOutlet]="formGroupControl"
                   [ngTemplateOutletContext]="{$implicit: model, control: control, type: 'SELECT'}">
      </ng-template>
    </nz-form-control>
  </nz-form-item>

  <!--<ng-container jdDyFormItemDef>
    <nz-form-item *jdDyFormItemWrapDef>
      <ng-container jdFormItemOutlet></ng-container>
    </nz-form-item>
  </ng-container>-->

  <jd-form-area *jdDyFormAreaDef></jd-form-area>
</jd-dy-form>
