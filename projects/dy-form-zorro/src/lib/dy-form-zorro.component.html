<!--通用错误提示-->
<ng-template #errorTpl let-control>
  <ng-container *ngIf="hasError(control)">
    {{getError(control)}}
  </ng-container>
</ng-template>


<ng-template #label let-model>
  <nz-form-label [nzRequired]="model.required"
                 jdDyFormLabelDef
                 [ngClass]="dyForm.labelClass(model)"
                 [ngStyle]="model.labelStyle"
                 [nzFor]="model.controlName">{{model.label}}
  </nz-form-label>
</ng-template>

<ng-template #inputControl let-model let-control=control>
  <input nz-input
         [id]="model.name"
         [placeholder]="model.placeHolder"
         [formControl]="control"
         [disabled]="model.disabled"
         [nzSize]="model.size"
         [type]="model.inputType"
         [readOnly]="model.readonly"/>
</ng-template>

<ng-template #inputNumberControl let-model let-control=control>
  <nz-input-number [formControl]="control"
                   class="dy-form-input-number"
                   [nzPlaceHolder]="model.placeHolder"
                   [nzMin]="model.min"
                   [nzStep]="model.step"
                   [nzPrecision]="model.precision"
                   [nzMax]="model.max"
                   [nzSize]="model.size"
                   [nzDisabled]="model.disabled">
  </nz-input-number>
</ng-template>

<ng-template #textAreaControl let-model let-control=control>
  <textarea nz-input
            [id]="model.controlName"
            [placeholder]="model.placeHolder"
            [formControl]="control"
            [disabled]="model.disabled"
            [nzSize]="model.size"
            [nzAutosize]="model.autosize"
            [readOnly]="model.readonly">
  </textarea>
</ng-template>

<ng-template #datePickerControl let-model let-control=control>
  <nz-date-picker [formControl]="control"
                  [nzDefaultPickerValue]="model.defaultPickerValue"
                  [nzDisabledDate]="model.disabledDate"
                  [nzDropdownClassName]="model.dropdownClassName"
                  [nzFormat]="model.format"
                  [nzInputReadOnly]="model.inputReadOnly"
                  [nzMode]="model.mode"
                  [nzPlaceHolder]="model.placeHolder"
                  [nzPopupStyle]="model.popupStyle"
                  [nzRenderExtraFooter]="model.renderExtraFooter"
                  [nzSuffixIcon]="model.suffixIcon"
                  (nzOnOpenChange)="model.onOpenChange"
                  [nzDateRender]="model.dateRender"
                  [nzDisabledTime]="model.disabledTime"
                  [nzShowTime]="model.showTime"
                  [nzShowToday]="model.showToday"
                  (nzOnOk)="model.onOk"
                  [nzAllowClear]="model.allowClear">
  </nz-date-picker>
</ng-template>


<ng-template #rangePickerControl let-model let-control=control>
  <nz-range-picker [formControl]="control"
                   [nzDefaultPickerValue]="model.defaultPickerValue"
                   [nzDisabledDate]="model.disabledDate"
                   [nzDropdownClassName]="model.dropdownClassName"
                   [nzFormat]="model.format"
                   [nzInputReadOnly]="model.inputReadOnly"
                   [nzMode]="model.mode"
                   [nzPopupStyle]="model.popupStyle"
                   [nzRenderExtraFooter]="model.renderExtraFooter"
                   [nzSuffixIcon]="model.suffixIcon"
                   (nzOnOpenChange)="model.onOpenChange"
                   [nzDateRender]="model.dateRender"
                   [nzDisabledTime]="model.disabledTime"
                   [nzShowTime]="model.showTime"
                   [nzShowToday]="model.showToday"
                   [nzRanges]="model.ranges"
                   [nzSeparator]="model.separator"
                   [nzPlaceHolder]="model.placeHolder"
                   (nzOnCalendarChange)="model.onCalendarChange"
                   (nzOnOk)="model.onOk"
                   [nzAllowClear]="model.allowClear">
  </nz-range-picker>
</ng-template>

<ng-template #timePickerControl let-model let-control=control>
  <nz-time-picker [formControl]="control"
                  [nzFormat]="model.format"
                  [nzAllowEmpty]="model.allowEmpty"
                  [nzPlaceHolder]="model.placeHolder"
                  [nzAddOn]="model.addon"
                  [nzClearText]="model.clearText"
                  [nzDefaultOpenValue]="model.defaultOpenValue"
                  [nzDisabledHours]="model.disabledHours"
                  [nzDisabledMinutes]="model.disabledMinutes"
                  [nzDisabledSeconds]="model.disabledSeconds"
                  [nzHideDisabledOptions]="model.hideDisabledOptions"
                  [nzHourStep]="model.hourStep"
                  [nzMinuteStep]="model.minuteStep"
                  [nzSecondStep]="model.secondStep"
                  [nzPopupClassName]="model.popupClassName"
                  [nzUse12Hours]="model.use12Hours"
                  [nzSuffixIcon]="model.suffixIcon"
                  (nzOpenChange)="model.openChange">
  </nz-time-picker>
</ng-template>

<ng-template #selectControl let-model let-control=control>
  <nz-select [formControl]="control"
             class="dy-form-select"
             style="width: 100%;"
             nzAllowClear
             [nzAllowClear]="model.allowClear"
             [nzSize]="model.size"
             [disabled]="model.disabled"
             [nzClearIcon]="model.clearIcon"
             [nzDropdownClassName]="model.dropdownClassName"
             [nzMaxTagCount]="model.maxTagCount"
             [nzMaxTagPlaceholder]="model.maxTagPlaceholder"
             (ngModelChange)="model.ngModelChange($event)"
             (nzOpenChange)="model.openChange($event)"
             [nzLoading]="model.loading"
             [nzRemoveIcon]="model.removeIcon"
             [nzSuffixIcon]="model.suffixIconPv"
             [nzShowSearch]="model.showSearch"
             [nzShowArrow]="model.showArrow"
             [nzDropdownMatchSelectWidth]="model.dropdownMatchSelectWidth"
             [nzMode]="model.mode"
             [nzDropdownStyle]="model.dropdownStyle"
             [nzMaxMultipleCount]="model.maxMultipleCount"
             [nzNotFoundContent]="model.notFoundContent"
             [nzMenuItemSelectedIcon]="model.menuItemSelectedIcon"
             [nzDisabled]="model.disabled"
             [nzPlaceHolder]="model.placeHolder">
    <nz-option *ngFor="let item of model.optionContent"
               [nzValue]="item.value"
               [nzLabel]="item.label"
               [nzDisabled]="item.disabled">
    </nz-option>
  </nz-select>
</ng-template>

<ng-template #formGroupControl let-model let-type=type let-control=control>
  <nz-input-group [nzAddOnAfter]="model.addOnAfter"
                  [nzAddOnBefore]="model.addOnBefore"
                  [nzPrefix]="model.prefix"
                  [nzSuffix]="model.suffix">
    <ng-container *ngIf="type === 'INPUT'">
      <ng-template [ngTemplateOutlet]="inputControl"
                   [ngTemplateOutletContext]="{$implicit: model, control: control}">
      </ng-template>
    </ng-container>
    <ng-container *ngIf="type === 'INPUT_NUMBER'">
      <ng-template [ngTemplateOutlet]="inputNumberControl"
                   [ngTemplateOutletContext]="{$implicit: model, control: control}">
      </ng-template>
    </ng-container>
    <ng-container *ngIf="type === 'SELECT'">
      <ng-template [ngTemplateOutlet]="selectControl"
                   [ngTemplateOutletContext]="{$implicit: model, control: control}">
      </ng-template>
    </ng-container>
  </nz-input-group>
</ng-template>

<jd-dy-form [dyFormRef]="dyFormRef" #dyForm>
  <nz-form-item *jdDyFormColumnDef="let control; let model = model name 'INPUT'">
    <ng-template [ngTemplateOutlet]="label" [ngTemplateOutletContext]="{$implicit: model}"></ng-template>

    <nz-form-control [nzErrorTip]="errorTpl"
                     jdDyFormControlDef
                     [nzHasFeedback]="model.hasFeedback"
                     [nzExtra]="model.extra"
                     [nzValidatingTip]="model.validatingTip"
                     [ngStyle]="model.controlStyle"
                     [nzValidateStatus]="control"
                     [ngClass]="dyForm.controlClass(model)">
      <!-- <input nz-input
              [id]="model.name"
              [placeholder]="model.placeHolder"
              [formControl]="control"
              [disabled]="model.disabled"
              [nzSize]="model.size"
              [readOnly]="model.readonly"/>-->
      <ng-template [ngTemplateOutlet]="inputControl"
                   [ngTemplateOutletContext]="{$implicit: model, control: control}">
      </ng-template>
    </nz-form-control>
  </nz-form-item>

  <nz-form-item *jdDyFormColumnDef="let control; let model = model name 'INPUT_GROUP'">
    <ng-template [ngTemplateOutlet]="label" [ngTemplateOutletContext]="{$implicit: model}"></ng-template>

    <nz-form-control [nzErrorTip]="errorTpl"
                     jdDyFormControlDef
                     [nzHasFeedback]="model.hasFeedback"
                     [nzExtra]="model.extra"
                     [nzValidatingTip]="model.validatingTip"
                     [nzValidateStatus]="control"
                     [ngStyle]="model.controlStyle"
                     [ngClass]="dyForm.controlClass(model)">
      <ng-template [ngTemplateOutlet]="formGroupControl"
                   [ngTemplateOutletContext]="{$implicit: model, control: control, type: 'INPUT'}">
      </ng-template>
    </nz-form-control>
  </nz-form-item>

  <nz-form-item *jdDyFormColumnDef="let control; let model = model name 'DATE_PICKER'">
    <ng-template [ngTemplateOutlet]="label" [ngTemplateOutletContext]="{$implicit: model}"></ng-template>

    <nz-form-control [nzErrorTip]="errorTpl"
                     jdDyFormControlDef
                     [nzHasFeedback]="model.hasFeedback"
                     [nzExtra]="model.extra"
                     [nzValidatingTip]="model.validatingTip"
                     [nzValidateStatus]="control"
                     [ngStyle]="model.controlStyle"
                     [ngClass]="dyForm.controlClass(model)">
      <ng-template [ngTemplateOutlet]="datePickerControl"
                   [ngTemplateOutletContext]="{$implicit: model, control: control, type: 'INPUT'}">
      </ng-template>
    </nz-form-control>
  </nz-form-item>

  <nz-form-item *jdDyFormColumnDef="let control; let model = model name 'TIME_PICKER'">
    <ng-template [ngTemplateOutlet]="label" [ngTemplateOutletContext]="{$implicit: model}"></ng-template>

    <nz-form-control [nzErrorTip]="errorTpl"
                     jdDyFormControlDef
                     [nzHasFeedback]="model.hasFeedback"
                     [nzExtra]="model.extra"
                     [nzValidatingTip]="model.validatingTip"
                     [nzValidateStatus]="control"
                     [ngStyle]="model.controlStyle"
                     [ngClass]="dyForm.controlClass(model)">
      <ng-template [ngTemplateOutlet]="timePickerControl"
                   [ngTemplateOutletContext]="{$implicit: model, control: control, type: 'INPUT'}">
      </ng-template>
    </nz-form-control>
  </nz-form-item>

  <nz-form-item *jdDyFormColumnDef="let control; let model = model name 'RANGE_PICKER'">
    <ng-template [ngTemplateOutlet]="label" [ngTemplateOutletContext]="{$implicit: model}"></ng-template>

    <nz-form-control [nzErrorTip]="errorTpl"
                     jdDyFormControlDef
                     [nzHasFeedback]="model.hasFeedback"
                     [nzExtra]="model.extra"
                     [nzValidatingTip]="model.validatingTip"
                     [nzValidateStatus]="control"
                     [ngStyle]="model.controlStyle"
                     [ngClass]="dyForm.controlClass(model)">
      <ng-template [ngTemplateOutlet]="rangePickerControl"
                   [ngTemplateOutletContext]="{$implicit: model, control: control, type: 'INPUT'}">
      </ng-template>
    </nz-form-control>
  </nz-form-item>

  <nz-form-item *jdDyFormColumnDef="let control; let model = model name 'INPUT_NUMBER'">
    <ng-template [ngTemplateOutlet]="label" [ngTemplateOutletContext]="{$implicit: model}"></ng-template>

    <nz-form-control [nzErrorTip]="errorTpl"
                     jdDyFormControlDef
                     [nzHasFeedback]="model.hasFeedback"
                     [nzExtra]="model.extra"
                     [nzValidatingTip]="model.validatingTip"
                     [nzValidateStatus]="control"
                     [ngStyle]="model.controlStyle"
                     [ngClass]="dyForm.controlClass(model)">
      <ng-template [ngTemplateOutlet]="inputNumberControl"
                   [ngTemplateOutletContext]="{$implicit: model, control: control}">
      </ng-template>
    </nz-form-control>
  </nz-form-item>

  <nz-form-item *jdDyFormColumnDef="let control; let model = model name 'INPUT_NUMBER_GROUP'">
    <ng-template [ngTemplateOutlet]="label" [ngTemplateOutletContext]="{$implicit: model}"></ng-template>

    <nz-form-control [nzErrorTip]="errorTpl"
                     jdDyFormControlDef
                     [nzHasFeedback]="model.hasFeedback"
                     [nzExtra]="model.extra"
                     [nzValidatingTip]="model.validatingTip"
                     [nzValidateStatus]="control"
                     [ngStyle]="model.controlStyle"
                     [ngClass]="dyForm.controlClass(model)">
      <ng-template [ngTemplateOutlet]="formGroupControl"
                   [ngTemplateOutletContext]="{$implicit: model, control: control, type: 'INPUT_NUMBER'}">
      </ng-template>
    </nz-form-control>
  </nz-form-item>

  <nz-form-item *jdDyFormColumnDef="let control; let model = model name 'TEXTAREA'">
    <ng-template [ngTemplateOutlet]="label" [ngTemplateOutletContext]="{$implicit: model}"></ng-template>

    <nz-form-control [nzErrorTip]="errorTpl"
                     jdDyFormControlDef
                     [nzHasFeedback]="model.hasFeedback"
                     [nzExtra]="model.extra"
                     [nzValidatingTip]="model.validatingTip"
                     [nzValidateStatus]="control"
                     [ngStyle]="model.controlStyle"
                     [ngClass]="dyForm.controlClass(model)">
      <ng-template [ngTemplateOutlet]="textAreaControl"
                   [ngTemplateOutletContext]="{$implicit: model, control: control}">
      </ng-template>
    </nz-form-control>
  </nz-form-item>

  <nz-form-item *jdDyFormColumnDef="let control; let model = model name 'SELECT'">
    <ng-template [ngTemplateOutlet]="label" [ngTemplateOutletContext]="{$implicit: model}"></ng-template>

    <nz-form-control [nzErrorTip]="errorTpl"
                     jdDyFormControlDef
                     [nzHasFeedback]="model.hasFeedback"
                     [nzExtra]="model.extra"
                     [nzValidatingTip]="model.validatingTip"
                     [nzValidateStatus]="control"
                     [ngStyle]="model.controlStyle"
                     [ngClass]="dyForm.controlClass(model)">
      <ng-template [ngTemplateOutlet]="selectControl"
                   [ngTemplateOutletContext]="{$implicit: model, control: control}">
      </ng-template>
    </nz-form-control>
  </nz-form-item>

  <nz-form-item *jdDyFormColumnDef="let control; let model = model name 'SELECT_GROUP'">
    <ng-template [ngTemplateOutlet]="label" [ngTemplateOutletContext]="{$implicit: model}"></ng-template>

    <nz-form-control [nzErrorTip]="errorTpl"
                     jdDyFormControlDef
                     [nzHasFeedback]="model.hasFeedback"
                     [nzExtra]="model.extra"
                     [nzValidatingTip]="model.validatingTip"
                     [nzValidateStatus]="control"
                     [ngStyle]="model.controlStyle"
                     [ngClass]="dyForm.controlClass(model)">
      <ng-template [ngTemplateOutlet]="formGroupControl"
                   [ngTemplateOutletContext]="{$implicit: model, control: control, type: 'SELECT'}">
      </ng-template>
    </nz-form-control>
  </nz-form-item>

  <!--<ng-container jdDyFormItemDef>
    <nz-form-item *jdDyFormItemWrapDef>
      <ng-container jdFormItemOutlet></ng-container>
    </nz-form-item>
  </ng-container>-->
  <jd-form-layout>
    <ng-container [ngSwitch]="dyFormRef.mode">
      <ng-container *ngSwitchCase="'vertical'">
        <form nz-form nzLayout="vertical" [formGroup]="dyForm.formArea">
          <ng-container *ngFor="let control of dyForm.options">
            <ng-container jdDyFormLayoutItemOutlet="{{control.name}}"></ng-container>
          </ng-container>
        </form>
      </ng-container>
      <ng-container *ngSwitchCase="'horizontal'">
        <form nz-form nzLayout="horizontal" [formGroup]="dyForm.formArea">
          <ng-container *ngFor="let control of dyForm.options">
            <ng-container jdDyFormLayoutItemOutlet="{{control.name}}"></ng-container>
          </ng-container>
        </form>
      </ng-container>
      <ng-container *ngSwitchCase="'inline'">
        <form nz-form nzLayout="inline" [formGroup]="dyForm.formArea">
          <ng-container *ngFor="let control of dyForm.options">
            <ng-container jdDyFormLayoutItemOutlet="{{control.name}}"></ng-container>
          </ng-container>
        </form>
      </ng-container>
      <ng-container *ngSwitchCase="'custom'">
        <ng-content select="jd-form-layout"></ng-content>
<!--        <ng-template [ngTemplateOutlet]="customLayoutDef?.template" [ngTemplateOutletContext]="{$implicit: dyForm.options}"></ng-template>-->
      </ng-container>
    </ng-container>
  </jd-form-layout>
</jd-dy-form>

